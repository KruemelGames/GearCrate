<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GearCrate - Star Citizen Inventory Manager</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="styles_panels.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="header-content">
                <div class="header-left">
                    <h1><img id="gear-logo" src="/img/GearCrate_Logo.png" alt="GearCrate Logo"> <span data-i18n="appTitle">GearCrate</span></h1>
                    <p class="subtitle">Star Citizen Inventory Manager</p>
                </div>
                <div class="header-right">
                    <div class="language-selector">
                        <label data-i18n="language">Language:</label>
                        <select id="language-select">
                            <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
                            <option value="en">ğŸ‡¬ğŸ‡§ English</option>
                            <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                            <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                        </select>
                    </div>
                </div>
            </div>
        </header>

        <!-- VIEW NAVIGATION -->
        <section class="view-navigation">
            <button id="view-btn-inventory" class="view-btn active">ğŸ“¦ <span data-i18n="inventory">Inventar</span></button>
            <button id="view-btn-gearsets" class="view-btn">ğŸ¯ Gear Sets</button>
            <button id="view-btn-import" class="view-btn">ğŸ“¥ Import from SC</button>
        </section>

        <!-- ========== LINKES DROPDOWN PANEL - SUCHE ========== -->
        <div class="panel-left-wrapper" id="panelLeftWrapper">
            <div class="panel-left compact" id="panelLeft">
                <div class="search-container">
                    <!-- Sucheingabe -->
                    <input type="text" class="search-input" id="search-input" data-i18n-placeholder="searchPlaceholder" placeholder="Suche Items..." autocomplete="off">

                    <!-- Search Limit Dropdown -->
                    <div class="search-limit-wrapper">
                        <label data-i18n="searchLimit">Ergebnisse zeigen:</label>
                        <select id="search-limit" class="search-limit-select">
                            <option value="10">10</option>
                            <option value="25" selected>25</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                            <option value="999" data-i18n="categoryAll">Alle</option>
                        </select>
                    </div>

                    <!-- "Show results:" Label UNTER dem Search Limit -->
                    <div class="search-results-label" id="searchResultsLabel" style="display: none;">
                        <span data-i18n="showResults">Show results:</span> <strong id="searchResultsCount">0</strong>
                    </div>

                    <!-- Suchergebnisse Liste (max 12 Items) -->
                    <div class="search-list" id="search-results"></div>

                    <!-- Item Preview (bleibt gleich) -->
                    <div id="item-preview" class="item-preview hidden">
                        <h3 id="preview-name"></h3>
                        <p id="preview-type"></p>
                        <img id="preview-image" src="" alt="Preview">
                        <button id="add-button" data-i18n="add">HinzufÃ¼gen</button>
                    </div>
                </div>
            </div>
            <div class="tab-left" id="tabLeft">
                <svg viewBox="0 0 55 85" preserveAspectRatio="none">
                    <path class="tab-bg" d="
                        M 0 0
                        L 42 8
                        Q 55 10 55 22
                        L 55 63
                        Q 55 75 42 77
                        L 0 85
                        Z
                    "/>
                    <path class="tab-border" d="
                        M 0 0
                        L 42 8
                        Q 55 10 55 22
                        L 55 63
                        Q 55 75 42 77
                        L 0 85
                    "/>
                </svg>
                <span class="tab-icon">ğŸ”</span>
            </div>
        </div>

        <!-- ========== RECHTES DROPDOWN PANEL - FILTER ========== -->
        <div class="panel-right-wrapper" id="panelRightWrapper">
            <div class="panel-right" id="panelRight">
                <div class="filter-container">
                    <!-- Filter-Eingabe -->
                    <input type="text" class="filter-input" id="filter-input" data-i18n-placeholder="inventoryFilter" placeholder="Inventar filtern..." autocomplete="off">

                    <!-- Sort Buttons 2x2 Grid -->
                    <div class="sort-grid">
                        <button class="sort-btn active" data-sort="name" id="sort-name">
                            <span data-i18n="sortName">Name</span>
                        </button>
                        <button class="sort-btn" data-sort="count" id="sort-count">
                            <span data-i18n="sortCount">Count</span>
                        </button>
                        <button class="sort-btn" data-sort="date" id="sort-date">
                            <span data-i18n="sortDate">Date</span>
                        </button>
                        <button class="order-btn" id="sort-order-btn" title="Sort Order">ğŸ”¼</button>
                    </div>

                    <!-- Abstand -->
                    <div class="filter-separator"></div>

                    <!-- Kategorie Buttons mit Icons -->
                    <div class="category-grid-panel" id="category-buttons-panel">
                        <!-- Buttons werden dynamisch geladen -->
                        <div style="color: #666; padding: 10px; font-size: 11px;" data-i18n="categoryLoading">Loading...</div>
                    </div>
                </div>
            </div>
            <div class="tab-right" id="tabRight">
                <svg viewBox="0 0 55 85" preserveAspectRatio="none">
                    <path class="tab-bg" d="
                        M 55 0
                        L 13 8
                        Q 0 10 0 22
                        L 0 63
                        Q 0 75 13 77
                        L 55 85
                        Z
                    "/>
                    <path class="tab-border" d="
                        M 55 0
                        L 13 8
                        Q 0 10 0 22
                        L 0 63
                        Q 0 75 13 77
                        L 55 85
                    "/>
                </svg>
                <span class="tab-icon">â˜°</span>
            </div>
        </div>

        <!-- ========== MAIN CONTENT AREA ========== -->
        <div id="main-content">
            <!-- Inventar View -->
            <div id="inventory-view" class="content-view active">
                <!-- Inventory Grid (bleibt identisch) -->
                <section class="inventory-section">
                    <div id="inventory-grid" class="inventory-grid">
                        <p style="text-align: center; color: #888;" data-i18n="inventoryEmpty">Lade Inventar...</p>
                    </div>
                </section>
            </div>

            <!-- Gear Sets View -->
            <div id="gearsets-view" class="content-view">
                <section class="gearsets-section">
                    <!-- Sticky Header -->
                    <div class="gearsets-header">
                        <!-- Set Selector Buttons -->
                        <div class="gearsets-selector">
                            <h3 class="control-title">ğŸ¯ Set auswÃ¤hlen:</h3>
                            <div id="set-buttons" class="set-buttons-grid">
                                <button class="set-btn active" data-set="ADP">ADP</button>
                                <!-- Buttons werden dynamisch geladen -->
                                <button class="set-btn set-btn-all" data-set="ALL">ğŸŒ Alle Sets</button>
                            </div>
                        </div>

                        <!-- Filter Buttons -->
                        <div class="gearsets-filter">
                            <button class="filter-btn active" data-filter="all">Alle</button>
                            <button class="filter-btn" data-filter="none">ğŸ”´ None (0/4)</button>
                            <button class="filter-btn" data-filter="1">ğŸ”µ 1/4</button>
                            <button class="filter-btn" data-filter="2">ğŸ”µ 2/4</button>
                            <button class="filter-btn" data-filter="3">ğŸ”µ 3/4</button>
                            <button class="filter-btn" data-filter="all-parts">ğŸŸ¢ ALL (4/4)</button>
                        </div>
                    </div>

                    <!-- Gear Sets Grid (scrollbar) -->
                    <div id="gearsets-grid" class="gearsets-grid">
                        <p style="text-align: center; color: #888;">Lade Gear Sets...</p>
                    </div>
                </section>
            </div>

            <!-- Import from SC View -->
            <div id="import-view" class="content-view">
                <section class="import-section">
                    <!-- Before Scan State -->
                    <div id="import-before-scan" class="import-state">
                        <h2 data-i18n="importTitle">ğŸ“¥ Import from Star Citizen</h2>

                        <!-- Admin Rights Warning -->
                        <div class="admin-warning">
                            <h3 data-i18n="importAdminRequired">âš ï¸ Administrator-Rechte erforderlich</h3>
                            <p data-i18n="importAdminWarning1">Der InvDetect Scanner benÃ¶tigt Admin-Rechte fÃ¼r Tastatur-Hooks und Fenster-Switching.</p>
                            <p data-i18n="importAdminWarning2" data-i18n-html="true"><strong>Bitte verwende:</strong> <code>start-browser-admin.bat</code> oder <code>start-desktop-admin.bat</code></p>
                            <p data-i18n="importAdminWarning3">Ohne Admin-Rechte wird der Scanner nicht funktionieren.</p>
                        </div>

                        <!-- Scan Mode Selection -->
                        <div class="scan-mode-selection">
                            <h3 data-i18n="importSelectScanMode">ğŸ¯ Scan Mode wÃ¤hlen:</h3>
                            <div class="mode-buttons">
                                <button class="mode-btn active" data-mode="1">
                                    <div class="mode-icon">ğŸ“¦</div>
                                    <div class="mode-title" data-i18n="importMode1Title">1x1 Items</div>
                                    <div class="mode-description" data-i18n="importMode1Desc">Normal (Waffen, RÃ¼stungen, etc.)</div>
                                </button>
                                <button class="mode-btn" data-mode="2">
                                    <div class="mode-icon">ğŸ‘”</div>
                                    <div class="mode-title" data-i18n="importMode2Title">1x2 Items</div>
                                    <div class="mode-description" data-i18n="importMode2Desc">Undersuits</div>
                                </button>
                            </div>
                        </div>

                        <!-- Resolution Selection -->
                        <div class="resolution-selection" style="margin-top: 20px;">
                            <h3 data-i18n="importSelectResolution">ğŸ–¥ï¸ AuflÃ¶sung wÃ¤hlen:</h3>
                            <div class="resolution-buttons">
                                <select id="resolution-select" class="resolution-select-dropdown">
                                    <option value="1920x1080" selected>1920x1080 (Full HD)</option>
                                    <option value="2560x1440">2560x1440 (QHD)</option>
                                    <option value="3840x2160">3840x2160 (4K UHD)</option>
                                    <option value="1280x720">1280x720 (HD)</option>
                                </select>
                            </div>
                        </div>

                        <!-- Instructions -->
                        <div class="scan-instructions">
                            <h3 data-i18n="importInstructions">ğŸ“‹ Anleitung:</h3>
                            <ol>
                                <li data-i18n="importStep1">WÃ¤hle den passenden Scan-Modus (1x1 oder 1x2)</li>
                                <li data-i18n="importStep2">Klicke auf "Scan Now"</li>
                                <li data-i18n="importStep3">Ein CMD-Fenster Ã¶ffnet sich mit "Press INSERT to start scan..."</li>
                                <li data-i18n="importStep4">Wechsle zu Star Citizen und Ã¶ffne dein Universal Inventory</li>
                                <li data-i18n="importStep5">DrÃ¼cke INSERT zum Starten</li>
                                <li data-i18n="importStep6">Der Scanner arbeitet automatisch</li>
                                <li data-i18n="importStep7" data-i18n-html="true"><strong>Abbruch:</strong> DrÃ¼cke DELETE oder bewege Maus in Bildschirmecke</li>
                                <li data-i18n="importStep8">Nach dem Scan werden die Ergebnisse hier angezeigt</li>
                            </ol>
                            <div class="scan-tip">
                                <span data-i18n="importTip" data-i18n-html="true">ğŸ’¡ <strong>Tipp:</strong> Stelle sicher, dass Star Citizen im Vollbild-Modus lÃ¤uft (1920x1080) fÃ¼r beste Ergebnisse.</span>
                            </div>
                        </div>

                        <!-- Start Scan Button -->
                        <button id="start-scan-btn" class="scan-btn" data-i18n="importScanNow">
                            ğŸš€ Scan Now
                        </button>
                    </div>

                    <!-- During Scan State -->
                    <div id="import-during-scan" class="import-state hidden">
                        <h2 data-i18n="importScanning">â³ Scan lÃ¤uft...</h2>
                        <p data-i18n="importScannerActive">Der Scanner ist aktiv. Bitte folge den Anweisungen im CMD-Fenster.</p>
                        <p data-i18n="importCancelInfo" data-i18n-html="true"><strong>Abbruch:</strong> DELETE-Taste oder Maus in Bildschirmecke</p>
                        <button id="check-results-btn" class="scan-btn" data-i18n="importCheckResults">
                            ğŸ” Ergebnisse prÃ¼fen
                        </button>
                    </div>

                    <!-- After Scan State - Results -->
                    <div id="import-after-scan" class="import-state hidden">
                        <h2 data-i18n="importScanComplete">âœ… Scan abgeschlossen</h2>

                        <!-- Category Filter for Results -->
                        <div class="import-controls">
                            <h3 data-i18n="importCategoryFilter">ğŸ·ï¸ Kategorie Filter:</h3>
                            <div id="import-category-buttons" class="category-grid">
                                <!-- Dynamic category buttons -->
                            </div>
                        </div>

                        <!-- Undo/Redo Controls -->
                        <div class="import-undo-controls">
                            <button id="undo-btn" class="undo-btn" disabled data-i18n="importUndo">â†¶ Undo</button>
                            <button id="redo-btn" class="redo-btn" disabled data-i18n="importRedo">â†· Redo</button>
                        </div>

                        <!-- Found Items -->
                        <div class="import-results-section">
                            <h3 data-i18n="importFoundItems">âœ… Gefundene Items (<span id="found-count">0</span>)</h3>
                            <div id="import-found-grid" class="import-grid">
                                <!-- Dynamic grid items -->
                            </div>
                        </div>

                        <!-- Not Found Items -->
                        <div class="import-results-section">
                            <h3 data-i18n="importNotFoundItems">â“ Nicht erkannte Items (<span id="notfound-count">0</span>)</h3>
                            <div id="import-notfound-list" class="import-notfound-list">
                                <!-- Dynamic list items -->
                            </div>
                            <button id="open-notdetected-btn" class="secondary-btn" data-i18n="importOpenNotDetected">
                                ğŸ“„ not_detected.md Ã¶ffnen
                            </button>
                        </div>

                        <!-- Import Actions -->
                        <div class="import-actions">
                            <button id="import-items-btn" class="scan-btn" data-i18n="importImportItems">
                                âœ… Items importieren
                            </button>
                            <button id="new-scan-btn" class="secondary-btn" data-i18n="importNewScan">
                                ğŸ”„ Neuer Scan
                            </button>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Stats Section - versteckt (jetzt im linken unteren Panel) -->
    <section class="stats-section" style="display: none;">
        <h2>ğŸ“Š <span data-i18n="statsTitle">Statistiken</span></h2>
        <div class="stats-grid">
            <div class="stat-item">
                <span class="stat-label" data-i18n="statsTotalInDb">Items in Datenbank:</span>
                <span class="stat-value" id="total-items-db">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label" data-i18n="statsInInventory">Items im Inventar:</span>
                <span class="stat-value" id="inventory-unique-items">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label" data-i18n="statsTotalCount">Gesamtanzahl:</span>
                <span class="stat-value" id="total-count">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label" data-i18n="statsCacheSize">Cache-GrÃ¶ÃŸe:</span>
                <span class="stat-value" id="cache-size">0 MB</span>
            </div>
        </div>

        <!-- Kategorie-Statistiken (dynamisch) -->
        <div id="category-stats" class="category-stats"></div>
    </section>

    <!-- Item Detail Modal -->
    <div id="item-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modal-name"></h2>
            <img id="modal-image" src="" alt="Item Image">
            <div class="modal-controls">
                <label data-i18n="modalCount">Anzahl:</label>
                <div class="count-controls">
                    <button onclick="changeCount(-1)">âˆ’</button>
                    <input type="number" id="modal-count" min="0" value="0">
                    <button onclick="changeCount(1)">+</button>
                </div>
            </div>
            <div class="modal-controls">
                <label data-i18n="modalNotes">Notizen:</label>
                <textarea id="modal-notes" rows="4" placeholder="Optionale Notizen..."></textarea>
            </div>
            <div class="modal-actions">
                <button onclick="deleteItem()" class="delete-btn" data-i18n="delete">LÃ¶schen</button>
            </div>
        </div>
    </div>

    <!-- ========== POPUP LINKS UNTEN - STATISTIK ========== -->
    <div class="panel-bottom-left-wrapper" id="popupStatsWrapper">
        <div class="panel-bottom-left" id="popupStats">
            <div class="popup-stats-content">
                <h3>ğŸ“Š <span data-i18n="statsTitle">Statistiken</span></h3>
                <div class="stat-item">
                    <span class="stat-label" data-i18n="statsTotalInDb">Items in Datenbank:</span>
                    <span class="stat-value" id="popup-total-items-db">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label" data-i18n="statsInInventory">Items im Inventar:</span>
                    <span class="stat-value" id="popup-inventory-unique-items">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label" data-i18n="statsTotalCount">Gesamtanzahl:</span>
                    <span class="stat-value" id="popup-total-count">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label" data-i18n="statsCacheSize">Cache-GrÃ¶ÃŸe:</span>
                    <span class="stat-value" id="popup-cache-size">0 MB</span>
                </div>

                <!-- Kategorie-Statistiken (dynamisch) -->
                <div id="popup-category-stats" class="category-stats"></div>
            </div>
        </div>
        <div class="tab-bottom-left" id="tabStatsToggle">
            <svg viewBox="0 0 55 85" preserveAspectRatio="none">
                <path class="tab-bg" d="
                    M 0 0
                    L 42 8
                    Q 55 10 55 22
                    L 55 63
                    Q 55 75 42 77
                    L 0 85
                    Z
                "/>
                <path class="tab-border" d="
                    M 0 0
                    L 42 8
                    Q 55 10 55 22
                    L 55 63
                    Q 55 75 42 77
                    L 0 85
                "/>
            </svg>
            <span class="tab-icon">ğŸ“Š</span>
        </div>
    </div>

    <!-- ========== POPUP RECHTS UNTEN - EINSTELLUNGEN ========== -->
    <div class="panel-bottom-right-wrapper" id="popupSettingsWrapper">
        <div class="panel-bottom-right" id="popupSettings">
            <div class="popup-settings-content">
                <h3>âš™ï¸ <span data-i18n="settingsTitle">Einstellungen</span></h3>
                <button id="clear-cache-btn" class="settings-btn" data-i18n="footerClearCache" title="Clear website cache and reload">
                    ğŸ—‘ï¸ Cache leeren
                </button>
                <button id="debug-btn" class="settings-btn" data-i18n="footerDebug" title="Open DevTools">
                    ğŸ› Debug
                </button>
                <button id="clear-inventory-btn" class="settings-btn" data-i18n="footerClearInventory" title="Set all item counts to 0">
                    ğŸ“¦ Inventar leeren
                </button>
            </div>
        </div>
        <div class="tab-bottom-right" id="tabSettingsToggle">
            <svg viewBox="0 0 55 85" preserveAspectRatio="none">
                <path class="tab-bg" d="
                    M 55 0
                    L 13 8
                    Q 0 10 0 22
                    L 0 63
                    Q 0 75 13 77
                    L 55 85
                    Z
                "/>
                <path class="tab-border" d="
                    M 55 0
                    L 13 8
                    Q 0 10 0 22
                    L 0 63
                    Q 0 75 13 77
                    L 55 85
                "/>
            </svg>
            <span class="tab-icon">âš™ï¸</span>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Translation Scripts (LOAD FIRST!) -->
    <script src="translations/german-translation.js"></script>
    <script src="translations/english-translation.js"></script>
    <script src="translations/french-translation.js"></script>
    <script src="translations/spanish-translation.js"></script>
    <script src="translations/translations.js"></script>

    <!-- Fuse.js for smart search -->
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>

    <!-- App Scripts -->
    <script src="api-adapter.js"></script>
    <script src="panel-manager.js"></script>
    <script src="panels.js"></script>
    <script src="bottom-popups.js"></script>
    <script src="app.js"></script>
    <script src="app_panels.js"></script>
    <script src="i18n-integration.js"></script>
</body>
</html>
